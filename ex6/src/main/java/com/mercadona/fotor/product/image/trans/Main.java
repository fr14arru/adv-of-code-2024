package com.mercadona.fotor.product.image.trans;

import java.util.ArrayList;
import java.util.HashSet;
import java.util.List;
import java.util.Set;

/**
 * <a href="https://adventofcode.com/2024/day/6">Day 6</a>
 */
public class Main {

    public static void main(String[] args) {

        part1();
    }

    private static void part1() {

        char[][] map = getCharArray(INPUT);

        List<int[]> obstructionPositions = getObstructionPositions(INPUT);

        int[] guardStartPosition = getGuardStartPosition(INPUT);

        int positions = guardMovePositionsCount(map, obstructionPositions, guardStartPosition);

        System.out.println(positions);
    }

    private static int guardMovePositionsCount(
            char[][] map,
            List<int[]> obstructionPositions,
            int[] guardPosition) {

        boolean outOfBounds = false;

        Set<Position> guardPositions = new HashSet<>();
        guardPositions.add(new Position(guardPosition[0], guardPosition[1]));

        GUARD_ORIENTATION = map[guardPosition[0]][guardPosition[1]];

        int[] previousPosition = guardPosition;

        while (!outOfBounds) {

            try {

                guardPosition = getGuardNextPosition(map, obstructionPositions, guardPosition);

                map[previousPosition[0]][previousPosition[1]] = 'X';
                map[guardPosition[0]][guardPosition[1]] = GUARD_ORIENTATION;

                guardPositions.add(new Position(guardPosition[0], guardPosition[1]));

            } catch (Exception e) {

                outOfBounds = true;
            }
        }

        return guardPositions.size();
    }

    private static int[] getGuardNextPosition(
            char[][] map,
            List<int[]> obstructionPositions,
            int[] guardPosition) {

        int[] nextPosition = new int[2];

        if (map[guardPosition[0]][guardPosition[1]] == '^') {

            if (nextPositionIsObstruction(new int[]{guardPosition[0] - 1, guardPosition[1]}, obstructionPositions)) {

                // Next position es guardPosition i, j + 1
                nextPosition[0] = guardPosition[0];
                nextPosition[1] = guardPosition[1] + 1;

                // Cambiar guard character to >
                GUARD_ORIENTATION = '>';

            } else {

                // Next position es guardPosition i - 1, j
                nextPosition[0] = guardPosition[0] - 1;
                nextPosition[1] = guardPosition[1];
            }
        } else if (map[guardPosition[0]][guardPosition[1]] == '<') {

            if (nextPositionIsObstruction(new int[]{guardPosition[0], guardPosition[1] - 1}, obstructionPositions)) {

                // Next position es guardPosition i - 1, j
                nextPosition[0] = guardPosition[0] - 1;
                nextPosition[1] = guardPosition[1];

                // Cambiar guard character to ^
                GUARD_ORIENTATION = '^';
            } else {

                // Next position es guardPosition i, j - 1
                nextPosition[0] = guardPosition[0];
                nextPosition[1] = guardPosition[1] - 1;
            }
        } else if (map[guardPosition[0]][guardPosition[1]] == '>') {

            if (nextPositionIsObstruction(new int[]{guardPosition[0], guardPosition[1] + 1}, obstructionPositions)) {

                // Next position es guardPosition i + 1, j
                nextPosition[0] = guardPosition[0] + 1;
                nextPosition[1] = guardPosition[1];

                // Cambiar guard character to v
                GUARD_ORIENTATION = 'v';
            } else {

                // Next position es guardPosition i, j + 1
                nextPosition[0] = guardPosition[0];
                nextPosition[1] = guardPosition[1] + 1;
            }
        } else if (map[guardPosition[0]][guardPosition[1]] == 'v') {

            if (nextPositionIsObstruction(new int[]{guardPosition[0] + 1, guardPosition[1]}, obstructionPositions)) {

                // Next position es guardPosition i, j - 1
                nextPosition[0] = guardPosition[0];
                nextPosition[1] = guardPosition[1] - 1;

                // Cambiar guard character to <
                GUARD_ORIENTATION = '<';
            } else {

                // Next position es guardPosition i + 1, j
                nextPosition[0] = guardPosition[0] + 1;
                nextPosition[1] = guardPosition[1];
            }
        }

        return nextPosition;
    }

    private static boolean nextPositionIsObstruction(
            int[] nextPosition,
            List<int[]> obstructionPositions) {

        boolean obstruction = false;

        for (int i = 0; i < obstructionPositions.size() && !obstruction; i++) {

            if (obstructionPositions.get(i)[0] == nextPosition[0] && obstructionPositions.get(i)[1] == nextPosition[1]) {

                obstruction = true;
            }
        }

        return obstruction;
    }

    private static char[][] getCharArray(String input) {

        String[] lines = input.split( "\n");

        char[][] result = new char[lines.length][lines[0].length()];

        for (int i = 0; i < lines.length; i++) {

            for (int j = 0; j < lines[i].length(); j++) {

                result[i][j] = lines[i].charAt(j);
            }
        }

        return result;
    }

    private static List<int[]> getObstructionPositions(String input) {

        String[] lines = input.split("\n");

        List<int[]> positions = new ArrayList<>();

        for (int i = 0; i < lines.length; i++) {

            for (int j = 0; j < lines[i].length(); j++) {

                if (lines[i].charAt(j) != '.' &&
                        !GUARD.contains(lines[i].charAt(j))) {

                    positions.add(new int[]{i, j});
                }
            }
        }

        return positions;
    }

    private static int[] getGuardStartPosition(String input) {

        boolean found = false;
        int[] startPosition = new int[2];

        String[] lines = input.split("\n");

        for (int i = 0; i < lines.length && !found; i++) {

            for (int j = 0; j < lines[i].length() && !found; j++) {

                if (GUARD.contains(lines[i].charAt(j))) {

                    found = true;
                    startPosition[0] = i;
                    startPosition[1] = j;
                }
            }
        }

        return startPosition;
    }

    private static char GUARD_ORIENTATION;

    private static List<Character> GUARD = new ArrayList<>(List.of('^', '<', '>', 'v'));

//    private static String INPUT = """
//            ....#.....
//            .........#
//            ..........
//            ..#.......
//            .......#..
//            ..........
//            .#..^.....
//            ........#.
//            #.........
//            ......#...
//            """;

    private static String INPUT = """
            ........#........................................#......#........#................................................................
            ....................................#......#.....#............#.............#..........#..........................................
            ......................#.......................................................#...................................................
            .......#..#..#....#...#...#....#..............#......#.......#...#................#.......#.......................................
            ......................#....##...#.......#....#.......................................#....................#.......................
            ...#............................#........................................#..........................#.....................#.......
            ....................#............#...............#......#.........#...........#...................................................
            ............................#......#...#................#.............#...........................................................
            .....#..#.........#....................#......................................................#........................#.........#
            .........#..##.#.........#.............................................#...........#........#....................##...............
            ...............#....#.........................##......#.....................#..............................................#......
            ..................##...................................#...........#........#....#.............#..................#........#.#....
            ....................................#...................#..............................#............#.............................
            .........#.....#................#..........................................#...................................#..............#...
            ...#....................#...................................#..##...................#.......#......................###.........#..
            ....................#............#....#.##....#.........#......#...#........................#.......................#..........#..
            ..............#...................................................................................#....................#..........
            .........#................#..............................#............................#...#.................#...............#.....
            ............................................................................................#...#............................#....
            ............#....................#................................#....#...............................#....#.....................
            ........................................#.........#..................................................#..#..................#......
            .............#.#............................#..#.....#............................................#....#..........................
            ................................................................................................#.........#..#..............#..#..
            ...........#..........#.#..#................#.#..#...#.........#..........................................#..........#..#.........
            .............................#....................#.......#....#.....#....#......#....................#..#...............##.......
            ..........#..............................................................................#....#.........#..#................#.....
            ..#..#...............................................................#.......#........#...........................#...............
            ...........................................................................#...##....................#.#....##....................
            .......................................#...............................................#.....................#.........#..........
            .......................................................#.......#....#................#.....................................#......
            .............#................#...................#.................#....................#..................#.#.........#.........
            .....................................................................#.....................................#......................
            ........................#..........................................#....#..#.#..........................................#.........
            ............#.......#..................#.................................................#..............#.......................#.
            .........................................................#...............#...#....#...........#.................................#.
            .........................#..........................#..#........................................................#.................
            ...............#....................................#.......#......................................#............#.................
            .#......................................................................................................#.........................
            #...#........................................................#.................#....#....................#...........#............
            ..#.........#................................................................#................................#.............#.....
            ..................................#.........................................................................#................#....
            ..............#..............................................#........#..................................#........................
            ......#............................................#.................................#............................#...............
            .......##..#.......................##............#...#...................#.#..........................................##..........
            .#......#.....................................................................#..#..........................#......#.............#
            .................#.....................#........##..#.........#........#................#.........................................
            ...........#.....#..........#........#............................................................................................
            .........................#......#.......................................#..............................#..........................
            ............#............................................................#..............#..............................#..........
            ..................#.........#...........................................................................................#.........
            #.#..................................#....................#......................#.............#.................................#
            ....#................#.................#...................#...........#......................................#...................
            ................#........................................................................................#....#.#.......#.....##..
            ..........#...#.......................................#........#.......................................#...#......................
            .......#..##........................#......##.........................#.........#.......#.............................#.....#.....
            ................#...............................................#....#..........#.....#.........#.........#.........#.............
            ...............................#............#....................................#......#......................................#..
            .#..#..................#............................................#....#............#...............##...#..........#...........
            ....#.............................................................................................................................
            .............................................................#...........................#..........#.............................
            .#........#..................#.....#.............#.....................................................#...#........#...........#.
            .......................#........................................#.....#............................#.#..................#.........
            ................#....#................#.......#............................#.......#.................#............................
            ....#.........#....#........#.....................#........................#............#.........................................
            .......#.......#.....................................................................##...........#...............................
            ...........#.........................................................#..........#............#....................................
            ..................#.............................#.......................................................................#.........
            ................#.....#........#.....#...#..........#.....................................#.....#........................#........
            ..........................................#.........#...........#.................................................................
            ...#.......................................................................................................#......................
            ....#..............#...........#..................................................#.................#.................#...........
            .#................#.....#.#.................................................................#.........................#...........
            ............#.........................##....................................#..............#......................................
            ...##...........#...#............#..........................................................................#.....................
            ............................................#......................#......#.......................................................
            ............#............................................................................................................#........
            ...................##..............#.#....#.##...................................................#..................#.............
            ..#...................................................................................#.........#.........................#.....#.
            ........................#..............................................#......#................................................#..
            ................#............#............................#.#...................#.....................#...........................
            ..................#......#................#.#......................#...................#...#......................................
            ..#................................................##...................................................................#.........
            ...........................#......................................................................#......#...#......#.............
            ........................#...#........#......#.......#..........#.............................#........#.....#.....................
            .................................................#..............................................#......#.....#....................
            .....#....#.................#......#........#.#..............^...........................#...................#..#.................
            .............................................................................#................................#...................
            #..........................#..#..............#.......#..........................#.................................................
            ............#.............................................................................#...................#...................
            ..................#.............................#.........................................#................#.........#......#.....
            ...#...............................#.....#......#............###.#.#.....................................#....#.............#.....
            ...........#...........#...........................#..............................................................................
            ............#..........................................#.....#.............#..........................#....................#.....#
            ........................#......#..#............................#.......................................................#..........
            ..#...#...#.......#.#..........................................#.............#.........#....#..................#...........#......
            ..................#.......#.....................................................................................#........#........
            ......##................#...........................................#..............##.................................#...........
            .................#................................................................................#.#....................#........
            ....................#.........#..........#...............#...#...#.#.#............................................................
            #..................#.#..........#..#...................................................................................#..........
            ..........#........................................................#..........##..........................#..##...................
            ...........#...................................................................#..................................................
            ..................#........#............................................#..................#....#.......................#..#......
            ............#...................#......#..........................................................................................
            ...........................#.....##..........#.#..............#......................#.............#.......#...........#..........
            ............#..................................................#.......#.........#.#..................#..............##...........
            #..................................................#...#......#..#......................#.............#........#............#.....
            ....#..................#..........#.........#.........................................#..................#................#.......
            ...#.................#.............................................................................#....................#.........
            ..........#.................................................................#............#....................#.#.#.....#.........
            .....................#......................#...........#........#................................................................
            .....#.......................................................................#......................#...#......#..................
            .............##........#.....................#...........##........#............#.....#.....................#...............#.....
            .....#.........#....#.................#....#...........#.......##..........#.........#.#......................................#...
            .......#..................##.......#...#.#...#...................................#.......................................#.....#..
            ...............#.......#.................#........................................................................................
            ......#.......#.....#...............................#...........#.......#......................##...#....#........................
            .##..........................##..................##................#..#....#...##.................................................
            ........#..............................#.#......#........#...............#....#........#.#........................................
            ...............................#..#.....................#.#...................#...................................................
            .....................#.................................................##...#.......#.................##...............#.......#..
            .............#..........................#.................................#..............#.......#..........#........#............
            .........................................#...................#.........................................................#..........
            ...............................#..........#..............................#............#.....#.....................................
            .............#..........................#....................#................................#...#............#..................
            ....#......#........#.......#......#................................................#...#......................................##.
            ..#...................................#........#.....................................#...#......#.........#..#..........#.........
            .......#.........#................................................................................................................
            ...........#...............................##.........................................#..#....................#.....#.#.......##..
            .........................#..#...............#............................#.............#..........................#..............#
            """;
}